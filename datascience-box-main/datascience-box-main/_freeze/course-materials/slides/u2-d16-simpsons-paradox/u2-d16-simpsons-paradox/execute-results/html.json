{
  "hash": "bac7d94e0b88d3d0a16bd956a18b5d8a",
  "result": {
    "markdown": "---\ntitle: \"Simpson's paradox\"\nsubtitle: \"<br><br> Data Science in a Box\"\nauthor: \"[datasciencebox.org](https://datasciencebox.org/)\"\noutput:\n  xaringan::moon_reader:\n    css: [\"../xaringan-themer.css\", \"../slides.css\"]\n    lib_dir: libs\n    anchor_sections: FALSE\n    nature:\n      ratio: \"16:9\"\n      highlightLines: true\n      highlightStyle: solarized-light\n      countIncrementalSlides: false\n---\n\n\n\n\nlayout: true\n  \n<div class=\"my-footer\">\n<span>\n<a href=\"https://datasciencebox.org\" target=\"_blank\">datasciencebox.org</a>\n</span>\n</div> \n\n---\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\nclass: middle\n\n# Case study: Berkeley admission data\n\n\n---\n\n## Berkeley admission data\n\n- Study carried out by the Graduate Division of the University of California, Berkeley in the early 70’s to evaluate whether there was a gender bias in graduate admissions.\n- The data come from six departments. For confidentiality we'll call them A-F. \n- We have information on whether the applicant was male or female and whether they were admitted or rejected. \n- First, we will evaluate whether the percentage of males admitted is indeed higher than females, overall. Next, we will calculate the same percentage for each department.\n\n---\n\n\n## Data\n\n.pull-left[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4,526 × 3\n   admit    gender dept \n   <fct>    <fct>  <ord>\n 1 Admitted Male   A    \n 2 Admitted Male   A    \n 3 Admitted Male   A    \n 4 Admitted Male   A    \n 5 Admitted Male   A    \n 6 Admitted Male   A    \n 7 Admitted Male   A    \n 8 Admitted Male   A    \n 9 Admitted Male   A    \n10 Admitted Male   A    \n11 Admitted Male   A    \n12 Admitted Male   A    \n13 Admitted Male   A    \n14 Admitted Male   A    \n15 Admitted Male   A    \n# … with 4,511 more rows\n```\n:::\n:::\n\n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  gender     n\n  <fct>  <int>\n1 Female  1835\n2 Male    2691\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 2\n  dept      n\n  <ord> <int>\n1 A       933\n2 B       585\n3 C       918\n4 D       792\n5 E       584\n6 F       714\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  admit        n\n  <fct>    <int>\n1 Rejected  2771\n2 Admitted  1755\n```\n:::\n:::\n\n]\n\n\n---\n\n.question[\nWhat can you say about the overall gender distribution? Hint: Calculate the following probabilities: $P(Admit | Male)$ and $P(Admit | Female)$.\n]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(gender, admit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n  gender admit        n\n  <fct>  <fct>    <int>\n1 Female Rejected  1278\n2 Female Admitted   557\n3 Male   Rejected  1493\n4 Male   Admitted  1198\n```\n:::\n:::\n\n---\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(gender, admit) %>%\n  group_by(gender) %>%\n  mutate(prop_admit = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 4\n# Groups:   gender [2]\n  gender admit        n prop_admit\n  <fct>  <fct>    <int>      <dbl>\n1 Female Rejected  1278      0.696\n2 Female Admitted   557      0.304\n3 Male   Rejected  1493      0.555\n4 Male   Admitted  1198      0.445\n```\n:::\n:::\n\n\n- $P(Admit | Female)$ = 0.304\n- $P(Admit | Male)$ = 0.445\n\n\n---\n\n## Overall gender distribution\n\n.panelset[\n\n.panel[.panel-name[Plot]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d16-simpsons-paradox_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=60%}\n:::\n:::\n]\n\n.panel[.panel-name[Code]\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(ucbadmit, aes(y = gender, fill = admit)) +\n  geom_bar(position = \"fill\") + \n  labs(title = \"Admit by gender\",\n       y = NULL, x = NULL)\n```\n:::\n]\n\n]\n\n---\n\n\n.question[\nWhat can you say about the gender distribution by department ?\n]\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(dept, gender, admit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 24 × 4\n  dept  gender admit        n\n  <ord> <fct>  <fct>    <int>\n1 A     Female Rejected    19\n2 A     Female Admitted    89\n3 A     Male   Rejected   313\n4 A     Male   Admitted   512\n5 B     Female Rejected     8\n6 B     Female Admitted    17\n# … with 18 more rows\n```\n:::\n:::\n\n---\n\n.question[\nLet's try again... What can you say about the gender distribution by department?\n]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(dept, gender, admit) %>%\n  pivot_wider(names_from = dept, values_from = n)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 8\n  gender admit        A     B     C     D     E     F\n  <fct>  <fct>    <int> <int> <int> <int> <int> <int>\n1 Female Rejected    19     8   391   244   299   317\n2 Female Admitted    89    17   202   131    94    24\n3 Male   Rejected   313   207   205   279   138   351\n4 Male   Admitted   512   353   120   138    53    22\n```\n:::\n:::\n\n---\n\n\n## Gender distribution, by department\n\n.panelset[\n\n.panel[.panel-name[Plot]\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d16-simpsons-paradox_files/figure-html/unnamed-chunk-8-1.png){fig-align='center' width=60%}\n:::\n:::\n\n]\n\n.panel[.panel-name[Code]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(ucbadmit, aes(y = gender, fill = admit)) +\n  geom_bar(position = \"fill\") +\n  facet_wrap(. ~ dept) +\n  scale_x_continuous(labels = label_percent()) +\n  labs(title = \"Admissions by gender and department\",\n       x = NULL, y = NULL, fill = NULL) +\n  theme(legend.position = \"bottom\")\n```\n:::\n\n]\n\n]\n\n\n---\n\n## Case for gender discrimination?\n\n.pull-left[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d16-simpsons-paradox_files/figure-html/unnamed-chunk-9-1.png){fig-align='center' width=100%}\n:::\n:::\n]\n.pull-right[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d16-simpsons-paradox_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=100%}\n:::\n:::\n]\n\n---\n\n\n## Closer look at departments\n\n.panelset[\n\n.panel[.panel-name[Output]\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 × 5\n# Groups:   dept, gender [12]\n   dept  gender n_admitted n_applied prop_admit\n   <ord> <fct>       <int>     <int>      <dbl>\n 1 A     Female         89       108     0.824 \n 2 A     Male          512       825     0.621 \n 3 B     Female         17        25     0.68  \n 4 B     Male          353       560     0.630 \n 5 C     Female        202       593     0.341 \n 6 C     Male          120       325     0.369 \n 7 D     Female        131       375     0.349 \n 8 D     Male          138       417     0.331 \n 9 E     Female         94       393     0.239 \n10 E     Male           53       191     0.277 \n11 F     Female         24       341     0.0704\n12 F     Male           22       373     0.0590\n```\n:::\n:::\n\n]\n\n.panel[.panel-name[Code]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(dept, gender, admit) %>%\n  group_by(dept, gender) %>%\n  mutate(\n    n_applied  = sum(n),\n    prop_admit = n / n_applied\n    ) %>%\n  filter(admit == \"Admitted\") %>%\n  rename(n_admitted = n) %>%\n  select(-admit) %>%\n  print(n = 12)\n```\n:::\n\n]\n\n]\n\n\n---\n\nclass: middle\n\n# Simpson's paradox\n\n---\n\n\n## Relationship between two variables\n\n.pull-left[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 3\n      x     y z    \n  <dbl> <dbl> <chr>\n1     2     4 A    \n2     3     3 A    \n3     4     2 A    \n4     5     1 A    \n5     6    11 B    \n6     7    10 B    \n# … with 2 more rows\n```\n:::\n:::\n\n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d16-simpsons-paradox_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=100%}\n:::\n:::\n\n]\n\n\n---\n\n## Relationship between two variables\n\n.pull-left[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 3\n      x     y z    \n  <dbl> <dbl> <chr>\n1     2     4 A    \n2     3     3 A    \n3     4     2 A    \n4     5     1 A    \n5     6    11 B    \n6     7    10 B    \n# … with 2 more rows\n```\n:::\n:::\n]\n.pull-right[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d16-simpsons-paradox_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=100%}\n:::\n:::\n]\n\n---\n\n\n## Considering a third variable\n\n.pull-left[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 3\n      x     y z    \n  <dbl> <dbl> <chr>\n1     2     4 A    \n2     3     3 A    \n3     4     2 A    \n4     5     1 A    \n5     6    11 B    \n6     7    10 B    \n# … with 2 more rows\n```\n:::\n:::\n\n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d16-simpsons-paradox_files/figure-html/unnamed-chunk-17-1.png){fig-align='center' width=100%}\n:::\n:::\n\n]\n\n\n---\n\n## Relationship between three variables\n\n.pull-left[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 8 × 3\n      x     y z    \n  <dbl> <dbl> <chr>\n1     2     4 A    \n2     3     3 A    \n3     4     2 A    \n4     5     1 A    \n5     6    11 B    \n6     7    10 B    \n# … with 2 more rows\n```\n:::\n:::\n]\n.pull-right[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d16-simpsons-paradox_files/figure-html/unnamed-chunk-19-1.png){fig-align='center' width=100%}\n:::\n:::\n]\n\n---\n\n\n## Simpson's paradox\n\n- Not considering an important variable when studying a relationship can result in **Simpson's paradox**\n- Simpson's paradox illustrates the effect that omission of an explanatory variable can have on the measure of association between another explanatory variable and a response variable\n- The inclusion of a third variable in the analysis can change the apparent relationship between the other two variables\n\n\n---\n\nclass: middle\n\n# Aside: `group_by()` and `count()`\n\n---\n\n\n## What does group_by() do?\n\n`group_by()` takes an existing data frame and converts it into a grouped data frame where subsequent operations are performed \"once per group\"\n\n.pull-left[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4,526 × 3\n  admit    gender dept \n  <fct>    <fct>  <ord>\n1 Admitted Male   A    \n2 Admitted Male   A    \n3 Admitted Male   A    \n4 Admitted Male   A    \n5 Admitted Male   A    \n6 Admitted Male   A    \n# … with 4,520 more rows\n```\n:::\n:::\n\n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>% \n  group_by(gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4,526 × 3\n# Groups:   gender [2]\n  admit    gender dept \n  <fct>    <fct>  <ord>\n1 Admitted Male   A    \n2 Admitted Male   A    \n3 Admitted Male   A    \n4 Admitted Male   A    \n5 Admitted Male   A    \n6 Admitted Male   A    \n# … with 4,520 more rows\n```\n:::\n:::\n\n]\n\n\n---\n\n## What does group_by() not do?\n\n`group_by()` does not sort the data, `arrange()` does\n\n.pull-left[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>% \n  group_by(gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4,526 × 3\n# Groups:   gender [2]\n  admit    gender dept \n  <fct>    <fct>  <ord>\n1 Admitted Male   A    \n2 Admitted Male   A    \n3 Admitted Male   A    \n4 Admitted Male   A    \n5 Admitted Male   A    \n6 Admitted Male   A    \n# … with 4,520 more rows\n```\n:::\n:::\n]\n.pull-right[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>% \n  arrange(gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4,526 × 3\n  admit    gender dept \n  <fct>    <fct>  <ord>\n1 Admitted Female A    \n2 Admitted Female A    \n3 Admitted Female A    \n4 Admitted Female A    \n5 Admitted Female A    \n6 Admitted Female A    \n# … with 4,520 more rows\n```\n:::\n:::\n]\n\n---\n\n\n## What does group_by() not do?\n\n`group_by()` does not create frequency tables, `count()` does\n\n.pull-left[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>% \n  group_by(gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4,526 × 3\n# Groups:   gender [2]\n  admit    gender dept \n  <fct>    <fct>  <ord>\n1 Admitted Male   A    \n2 Admitted Male   A    \n3 Admitted Male   A    \n4 Admitted Male   A    \n5 Admitted Male   A    \n6 Admitted Male   A    \n# … with 4,520 more rows\n```\n:::\n:::\n\n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>% \n  count(gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  gender     n\n  <fct>  <int>\n1 Female  1835\n2 Male    2691\n```\n:::\n:::\n\n]\n\n\n---\n\n## Undo grouping with ungroup()\n\n.pull-left[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(gender, admit) %>%\n  group_by(gender) %>%\n  mutate(prop_admit = n / sum(n)) %>%\n  select(gender, prop_admit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 2\n# Groups:   gender [2]\n  gender prop_admit\n  <fct>       <dbl>\n1 Female      0.696\n2 Female      0.304\n3 Male        0.555\n4 Male        0.445\n```\n:::\n:::\n]\n.pull-right[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(gender, admit) %>%\n  group_by(gender) %>%\n  mutate(prop_admit = n / sum(n)) %>%\n  select(gender, prop_admit) %>%\n  ungroup()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 2\n  gender prop_admit\n  <fct>       <dbl>\n1 Female      0.696\n2 Female      0.304\n3 Male        0.555\n4 Male        0.445\n```\n:::\n:::\n]\n\n---\n\n\n## count() is a short-hand\n\n`count()` is a short-hand for `group_by()` and then `summarise()` to count the number of observations in each group\n\n.pull-left[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  group_by(gender) %>%\n  summarise(n = n()) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  gender     n\n  <fct>  <int>\n1 Female  1835\n2 Male    2691\n```\n:::\n:::\n\n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(gender)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  gender     n\n  <fct>  <int>\n1 Female  1835\n2 Male    2691\n```\n:::\n:::\n\n]\n\n\n---\n\n## count can take multiple arguments\n\n.pull-left[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  group_by(gender, admit) %>%\n  summarise(n = n()) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n# Groups:   gender [2]\n  gender admit        n\n  <fct>  <fct>    <int>\n1 Female Rejected  1278\n2 Female Admitted   557\n3 Male   Rejected  1493\n4 Male   Admitted  1198\n```\n:::\n:::\n]\n.pull-right[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  count(gender, admit)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n  gender admit        n\n  <fct>  <fct>    <int>\n1 Female Rejected  1278\n2 Female Admitted   557\n3 Male   Rejected  1493\n4 Male   Admitted  1198\n```\n:::\n:::\n]\n\n---\n\n\n## `summarise()` after `group_by()`\n\n- `count()` ungroups after itself\n- `summarise()` peels off one layer of grouping by default, or you can specify a different behaviour\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nucbadmit %>%\n  group_by(gender, admit) %>%\n  summarise(n = n()) \n```\n\n::: {.cell-output .cell-output-stderr}\n```\n`summarise()` has grouped output by 'gender'. You can override\nusing the `.groups` argument.\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n# Groups:   gender [2]\n  gender admit        n\n  <fct>  <fct>    <int>\n1 Female Rejected  1278\n2 Female Admitted   557\n3 Male   Rejected  1493\n4 Male   Admitted  1198\n```\n:::\n:::\n",
    "supporting": [
      "u2-d16-simpsons-paradox_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/font-awesome/css/all.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/font-awesome/css/v4-shims.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/panelset/panelset.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/panelset/panelset.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}