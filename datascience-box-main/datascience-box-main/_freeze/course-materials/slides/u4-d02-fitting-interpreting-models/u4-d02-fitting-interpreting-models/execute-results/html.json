{
  "hash": "163cb5cb2e082cc153ab9c2ca2d5b1e7",
  "result": {
    "markdown": "---\ntitle: \"Fitting and interpreting models\"\nsubtitle: \"<br><br> Data Science in a Box\"\nauthor: \"[datasciencebox.org](https://datasciencebox.org/)\"\noutput:\n  xaringan::moon_reader:\n    css: [\"../xaringan-themer.css\", \"../slides.css\"]\n    lib_dir: libs\n    anchor_sections: FALSE\n    nature:\n      ratio: \"16:9\"\n      highlightLines: true\n      highlightStyle: solarized-light\n      countIncrementalSlides: false\n---\n\n\n\n\nlayout: true\n  \n<div class=\"my-footer\">\n<span>\n<a href=\"https://datasciencebox.org\" target=\"_blank\">datasciencebox.org</a>\n</span>\n</div> \n\n---\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\nclass: middle\n\n# Models with numerical explanatory variables\n\n\n---\n\n## Data: Paris Paintings\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npp <- read_csv(\"data/paris-paintings.csv\", na = c(\"n/a\", \"\", \"NA\"))\n```\n:::\n\n- Number of observations: 3393\n- Number of variables: 61\n\n---\n\n\n## Goal: Predict height from width\n\n\n$$\\widehat{height}_{i} = \\beta_0 + \\beta_1 \\times width_{i}$$\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u4-d02-fitting-interpreting-models_files/figure-html/height-width-plot-1.png){fig-align='center' width=60%}\n:::\n:::\n\n---\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](img/tidymodels.png){fig-align='center' width=98%}\n:::\n:::\n\n---\n\n\n## Step 1: Specify model\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlinear_reg()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n```\n:::\n:::\n\n---\n\n## Step 2: Set model fitting *engine*\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlinear_reg() %>%\n  set_engine(\"lm\") # lm: linear model\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nLinear Regression Model Specification (regression)\n\nComputational engine: lm \n```\n:::\n:::\n\n---\n\n\n## Step 3: Fit model & estimate parameters\n\n... using **formula syntax**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlinear_reg() %>%\n  set_engine(\"lm\") %>%\n  fit(Height_in ~ Width_in, data = pp)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nparsnip model object\n\n\nCall:\nstats::lm(formula = Height_in ~ Width_in, data = data)\n\nCoefficients:\n(Intercept)     Width_in  \n     3.6214       0.7808  \n```\n:::\n:::\n\n---\n\n## A closer look at model output\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\nparsnip model object\n\n\nCall:\nstats::lm(formula = Height_in ~ Width_in, data = data)\n\nCoefficients:\n(Intercept)     Width_in  \n     3.6214       0.7808  \n```\n:::\n:::\n\n.large[\n\n$$\\widehat{height}_{i} = 3.6214 + 0.7808 \\times width_{i}$$\n\n]\n\n---\n\n\n## A tidy look at model output\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlinear_reg() %>%\n  set_engine(\"lm\") %>%\n  fit(Height_in ~ Width_in, data = pp) %>%\n  tidy()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term        estimate std.error statistic  p.value\n  <chr>          <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)    3.62    0.254        14.3 8.82e-45\n2 Width_in       0.781   0.00950      82.1 0       \n```\n:::\n:::\n\n\n.large[\n\n$$\\widehat{height}_{i} = 3.62 + 0.781 \\times width_{i}$$\n\n]\n\n\n---\n\n## Slope and intercept\n\n.large[\n\n$$\\widehat{height}_{i} = 3.62 + 0.781 \\times width_{i}$$\n\n]\n\n--\n\n- **Slope:** For each additional inch the painting is wider, the height is expected to be higher, on average, by 0.781 inches.\n\n--\n- **Intercept:** Paintings that are 0 inches wide are expected to be 3.62 inches high, on average. (Does this make sense?)\n\n---\n\n\n## Correlation does not imply causation\n\nRemember this when interpreting model coefficients\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](img/cell_phones.png){fig-align='center' width=90%}\n:::\n:::\n\n\n.footnote[\nSource: XKCD, [Cell phones](https://xkcd.com/925/)\n]\n\n\n---\n\nclass: middle\n\n# Parameter estimation\n\n---\n\n\n## Linear model with a single predictor\n\n- We're interested in $\\beta_0$ (population parameter for the intercept) and $\\beta_1$ (population parameter for the slope) in the following model:\n\n\n$$\\hat{y}_{i} = \\beta_0 + \\beta_1~x_{i}$$\n\n\n--\n- Tough luck, you can't have them...\n\n--\n- So we use sample statistics to estimate them:\n\n\n$$\\hat{y}_{i} = b_0 + b_1~x_{i}$$\n\n---\n\n## Least squares regression\n\n- The regression line minimizes the sum of squared residuals.\n\n--\n- If $e_i = y_i - \\hat{y}_i$, then, the regression line minimizes \n$\\sum_{i = 1}^n e_i^2$.\n\n---\n\n\n## Visualizing residuals\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u4-d02-fitting-interpreting-models_files/figure-html/vis-res-1-1.png){fig-align='center' width=70%}\n:::\n:::\n\n---\n\n## Visualizing residuals (cont.)\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u4-d02-fitting-interpreting-models_files/figure-html/vis-res-2-1.png){fig-align='center' width=70%}\n:::\n:::\n\n---\n\n\n## Visualizing residuals (cont.)\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u4-d02-fitting-interpreting-models_files/figure-html/vis-res-3-1.png){fig-align='center' width=70%}\n:::\n:::\n\n---\n\n## Properties of least squares regression\n\n- The regression line goes through the center of mass point, the coordinates corresponding to average $x$ and average $y$, $(\\bar{x}, \\bar{y})$:  \n\n\n$$\\bar{y} = b_0 + b_1 \\bar{x} ~ \\rightarrow ~ b_0 = \\bar{y} - b_1 \\bar{x}$$\n\n\n--\n- The slope has the same sign as the correlation coefficient: $b_1 = r \\frac{s_y}{s_x}$\n\n--\n- The sum of the residuals is zero: $\\sum_{i = 1}^n e_i = 0$\n\n--\n- The residuals and $x$ values are uncorrelated\n\n---\n\n\nclass: middle\n\n# Models with categorical explanatory variables\n\n\n---\n\n## Categorical predictor with 2 levels\n\n.pull-left-narrow[\n.small[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,393 × 3\n   name      Height_in landsALL\n   <chr>         <dbl>    <dbl>\n 1 L1764-2          37        0\n 2 L1764-3          18        0\n 3 L1764-4          13        1\n 4 L1764-5a         14        1\n 5 L1764-5b         14        1\n 6 L1764-6           7        0\n 7 L1764-7a          6        0\n 8 L1764-7b          6        0\n 9 L1764-8          15        0\n10 L1764-9a          9        0\n11 L1764-9b          9        0\n12 L1764-10a        16        1\n13 L1764-10b        16        1\n14 L1764-10c        16        1\n15 L1764-11         20        0\n16 L1764-12a        14        1\n17 L1764-12b        14        1\n18 L1764-13a        15        1\n19 L1764-13b        15        1\n20 L1764-14         37        0\n# … with 3,373 more rows\n```\n:::\n:::\n]\n]\n.pull-right-wide[\n- `landsALL = 0`: No landscape features\n- `landsALL = 1`: Some landscape features\n]\n\n---\n\n\n## Height & landscape features\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlinear_reg() %>%\n  set_engine(\"lm\") %>%\n  fit(Height_in ~ factor(landsALL), data = pp) %>%\n  tidy()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 5\n  term              estimate std.error statistic  p.value\n  <chr>                <dbl>     <dbl>     <dbl>    <dbl>\n1 (Intercept)          22.7      0.328      69.1 0       \n2 factor(landsALL)1    -5.65     0.532     -10.6 7.97e-26\n```\n:::\n:::\n\n---\n\n## Height & landscape features\n\n\n$$\\widehat{Height_{in}} = 22.7 - 5.645~landsALL$$\n\n\n- **Slope:** Paintings with landscape features are expected, on average, to be 5.645 inches shorter than paintings that without landscape features\n  - Compares baseline level (`landsALL = 0`) to the other level (`landsALL = 1`)\n    \n- **Intercept:** Paintings that don't have landscape features are expected, on average, to be 22.7 inches tall\n\n---\n\n\n## Relationship between height and school\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlinear_reg() %>%\n  set_engine(\"lm\") %>%\n  fit(Height_in ~ school_pntg, data = pp) %>%\n  tidy()\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term            estimate std.error statistic p.value\n  <chr>              <dbl>     <dbl>     <dbl>   <dbl>\n1 (Intercept)        14.0       10.0     1.40  0.162  \n2 school_pntgD/FL     2.33      10.0     0.232 0.816  \n3 school_pntgF       10.2       10.0     1.02  0.309  \n4 school_pntgG        1.65      11.9     0.139 0.889  \n5 school_pntgI       10.3       10.0     1.02  0.306  \n6 school_pntgS       30.4       11.4     2.68  0.00744\n7 school_pntgX        2.87      10.3     0.279 0.780  \n```\n:::\n:::\n\n---\n\n## Dummy variables\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term            estimate std.error statistic p.value\n  <chr>              <dbl>     <dbl>     <dbl>   <dbl>\n1 (Intercept)        14.0       10.0     1.40  0.162  \n2 school_pntgD/FL     2.33      10.0     0.232 0.816  \n3 school_pntgF       10.2       10.0     1.02  0.309  \n4 school_pntgG        1.65      11.9     0.139 0.889  \n5 school_pntgI       10.3       10.0     1.02  0.306  \n6 school_pntgS       30.4       11.4     2.68  0.00744\n7 school_pntgX        2.87      10.3     0.279 0.780  \n```\n:::\n:::\n\n- When the categorical explanatory variable has many levels, they're encoded to **dummy variables**\n- Each coefficient describes the expected difference between heights in that particular school compared to the baseline level\n\n---\n\n\n## Categorical predictor with 3+ levels\n\n.pull-left-wide[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> school_pntg </th>\n   <th style=\"text-align:center;\"> D_FL </th>\n   <th style=\"text-align:center;\"> F </th>\n   <th style=\"text-align:center;\"> G </th>\n   <th style=\"text-align:center;\"> I </th>\n   <th style=\"text-align:center;\"> S </th>\n   <th style=\"text-align:center;\"> X </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> A </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> D/FL </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(122, 209, 81, 1) !important;\"> 1 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> F </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(122, 209, 81, 1) !important;\"> 1 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> G </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(122, 209, 81, 1) !important;\"> 1 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> I </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(122, 209, 81, 1) !important;\"> 1 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> S </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(122, 209, 81, 1) !important;\"> 1 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> X </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(68, 1, 84, 1) !important;\"> 0 </td>\n   <td style=\"text-align:center;width: 10em; color: white !important;background-color: rgba(122, 209, 81, 1) !important;\"> 1 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n]\n.pull-right-narrow[\n.small[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3,393 × 3\n   name      Height_in school_pntg\n   <chr>         <dbl> <chr>      \n 1 L1764-2          37 F          \n 2 L1764-3          18 I          \n 3 L1764-4          13 D/FL       \n 4 L1764-5a         14 F          \n 5 L1764-5b         14 F          \n 6 L1764-6           7 I          \n 7 L1764-7a          6 F          \n 8 L1764-7b          6 F          \n 9 L1764-8          15 I          \n10 L1764-9a          9 D/FL       \n11 L1764-9b          9 D/FL       \n12 L1764-10a        16 X          \n13 L1764-10b        16 X          \n14 L1764-10c        16 X          \n15 L1764-11         20 D/FL       \n16 L1764-12a        14 D/FL       \n17 L1764-12b        14 D/FL       \n18 L1764-13a        15 D/FL       \n19 L1764-13b        15 D/FL       \n20 L1764-14         37 F          \n# … with 3,373 more rows\n```\n:::\n:::\n\n]\n]\n\n\n---\n\n## Relationship between height and school\n\n.small[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7 × 5\n  term            estimate std.error statistic p.value\n  <chr>              <dbl>     <dbl>     <dbl>   <dbl>\n1 (Intercept)        14.0       10.0     1.40  0.162  \n2 school_pntgD/FL     2.33      10.0     0.232 0.816  \n3 school_pntgF       10.2       10.0     1.02  0.309  \n4 school_pntgG        1.65      11.9     0.139 0.889  \n5 school_pntgI       10.3       10.0     1.02  0.306  \n6 school_pntgS       30.4       11.4     2.68  0.00744\n7 school_pntgX        2.87      10.3     0.279 0.780  \n```\n:::\n:::\n\n- **Austrian school (A)** paintings are expected, on average, to be **14 inches** tall.\n- **Dutch/Flemish school (D/FL)** paintings are expected, on average, to be **2.33 inches taller** than *Austrian school* paintings.\n- **French school (F)** paintings are expected, on average, to be **10.2 inches taller** than *Austrian school* paintings.\n- **German school (G)** paintings are expected, on average, to be **1.65 inches taller** than *Austrian school* paintings.\n- **Italian school (I)** paintings are expected, on average, to be **10.3 inches taller** than *Austrian school* paintings.\n- **Spanish school (S)** paintings are expected, on average, to be **30.4 inches taller** than *Austrian school* paintings.\n- Paintings whose school is **unknown (X)** are expected, on average, to be **2.87 inches taller** than *Austrian school* paintings.\n]\n",
    "supporting": [
      "u4-d02-fitting-interpreting-models_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/font-awesome/css/all.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/font-awesome/css/v4-shims.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/panelset/panelset.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/panelset/panelset.js\"></script>\n<script src=\"../../../site_libs/kePrint/kePrint.js\"></script>\n<link href=\"../../../site_libs/lightable/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}