{
  "hash": "055d86f36a80899a8dafa8a444deb04f",
  "result": {
    "markdown": "---\ntitle: \"Hypothesis testing\"\nsubtitle: \"<br><br> Data Science in a Box\"\nauthor: \"[datasciencebox.org](https://datasciencebox.org/)\"\noutput:\n  xaringan::moon_reader:\n    css: [\"../xaringan-themer.css\", \"../slides.css\"]\n    lib_dir: libs\n    anchor_sections: FALSE\n    nature:\n      ratio: \"16:9\"\n      highlightLines: true\n      highlightStyle: solarized-light\n      countIncrementalSlides: false\n---\n\n\n\n\nlayout: true\n  \n<div class=\"my-footer\">\n<span>\n<a href=\"https://datasciencebox.org\" target=\"_blank\">datasciencebox.org</a>\n</span>\n</div> \n\n---\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\nclass: middle\n\n# Hypothesis testing for a single proportion\n\n\n---\n\n## Packages\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(tidymodels)\n```\n:::\n\n\n---\n\n\n## Organ donors\n\nPeople providing an organ for donation sometimes seek the help of a special \"medical consultant\". These consultants assist the patient in all aspects of the surgery, with the goal of reducing the possibility of complications during the medical procedure and recovery. Patients might choose a consultant based in part on the historical complication rate of the consultant's clients. \n\nOne consultant tried to attract patients by noting that the average complication rate for liver donor surgeries in the US is about 10%, but her clients have only had 3 complications in the 62 liver donor surgeries she has facilitated. She claims this is strong evidence that her work meaningfully contributes to reducing complications (and therefore she should be hired!).\n\n\n---\n\n## Data\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\norgan_donor %>%\n  count(outcome)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 2\n  outcome             n\n  <chr>           <int>\n1 complication        3\n2 no complication    59\n```\n:::\n:::\n\n---\n\n\n## Parameter vs. statistic\n\nA **parameter** for a hypothesis test is the \"true\" value of interest. We typically estimate the parameter using a **sample statistic** as a **point estimate**.\n\n$p~$: true rate of complication\n\n$\\hat{p}~$: rate of complication in the sample = $\\frac{3}{62}$ = \n0.048\n\n\n---\n\n## Correlation vs. causation\n\n.question[\nIs it possible to assess the consultant's claim using the data?\n]\n\n--\n\nNo. The claim is that there is a causal connection, but the data are observational.\nFor example, maybe patients who can afford a medical consultant can afford better medical care, which can also lead to a lower complication rate.\n\nWhile it is not possible to assess the causal claim, it is still possible to test for an association using these data. For this question we ask, could the low complication rate of $\\hat{p}$ = 0.048 be due to chance?\n\n---\n\n\n## Two claims\n\n- **Null hypothesis:** \"There is nothing going on\"\n\nComplication rate for this consultant is no different than the US average of 10%\n\n--\n\n- **Alternative hypothesis:** \"There is something going on\"\n\nComplication rate for this consultant is **lower** than the US average of 10%\n\n\n---\n\n## Hypothesis testing as a court trial\n\n- **Null hypothesis**, $H_0$: Defendant is innocent\n\n- **Alternative hypothesis**, $H_A$: Defendant is guilty\n\n--\n\n- **Present the evidence:** Collect data\n\n--\n\n- **Judge the evidence:** \"Could these data plausibly have happened by chance if the null hypothesis were true?\"\n    * Yes: Fail to reject $H_0$\n    * No: Reject $H_0$\n    \n---\n\n\n## Hypothesis testing framework\n\n- Start with a null hypothesis, $H_0$, that represents the status quo\n\n- Set an alternative hypothesis, $H_A$, that represents the research question, i.e. what we’re testing for\n\n- Conduct a hypothesis test under the assumption that the null hypothesis is true and calculate a **p-value** (probability of observed or more extreme outcome given that the null hypothesis is true)\n    - if the test results suggest that the data do not provide convincing evidence for the alternative hypothesis, stick with the null hypothesis\n    - if they do, then reject the null hypothesis in favor of the alternative\n\n\n---\n\n## Setting the hypotheses\n\n.question[\nWhich of the following is the correct set of hypotheses?\n]\n\n(a) $H_0: p = 0.10$; $H_A: p \\ne 0.10$ <br>\n\n(b) $H_0: p = 0.10$; $H_A: p > 0.10$ <br>\n\n(c) $H_0: p = 0.10$; $H_A: p < 0.10$ <br>\n\n(d) $H_0: \\hat{p} = 0.10$; $H_A: \\hat{p} \\ne 0.10$ <br>\n\n(e) $H_0: \\hat{p} = 0.10$; $H_A: \\hat{p} > 0.10$ <br>\n\n(f) $H_0: \\hat{p} = 0.10$; $H_A: \\hat{p} < 0.10$ <br>\n\n---\n\n\n## Simulating the null distribution\n\nSince $H_0: p = 0.10$, we need to simulate a null distribution where the probability of success (complication) for each trial (patient) is 0.10.\n\n.question[\nDescribe how you would simulate the null distribution for this study using a bag of chips. How many chips? What colors? What do the colors indicate? How many draws? <b>With replacement</b> or <b>without replacement</b>?\n]\n\n\n---\n\n## What do we expect?\n\n.question[\nWhen sampling from the null distribution, what is the expected proportion of success (complications)?\n]\n\n---\n\n\n## Simulation #1\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\nsim1\n   complication no complication \n              3              59 \n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.0483871\n```\n:::\n\n::: {.cell-output-display}\n![](u4-d12-hypothesis-testing_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=50%}\n:::\n:::\n\n---\n\n## Simulation #2\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\nsim2\n   complication no complication \n              9              53 \n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1451613\n```\n:::\n\n::: {.cell-output-display}\n![](u4-d12-hypothesis-testing_files/figure-html/unnamed-chunk-6-1.png){fig-align='center' width=50%}\n:::\n:::\n\n---\n\n\n## Simulation #3\n\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\nsim3\n   complication no complication \n              8              54 \n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 0.1290323\n```\n:::\n\n::: {.cell-output-display}\n![](u4-d12-hypothesis-testing_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=50%}\n:::\n:::\n\n---\n\n## This is getting boring...\n\nWe need a way to automate this process!\n\n---\n\n\n## Using tidymodels to generate the null distribution\n\n.small[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nnull_dist <- organ_donor %>%\n  specify(response = outcome, success = \"complication\") %>%\n  hypothesize(null = \"point\", p = c(\"complication\" = 0.10, \"no complication\" = 0.90)) %>% \n  generate(reps = 100, type = \"simulate\") %>% \n  calculate(stat = \"prop\")\n```\n:::\n\n]\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\nResponse: outcome (factor)\nNull Hypothesis: point\n# A tibble: 100 × 2\n  replicate  stat\n      <dbl> <dbl>\n1         1 0.161\n2         2 0.081\n3         3 0.161\n4         4 0.145\n5         5 0.097\n6         6 0.145\n# … with 94 more rows\n```\n:::\n:::\n\n---\n\n## Visualizing the null distribution\n\n.question[\nWhat would you expect the center of the null distribution to be?\n]\n\n--\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = null_dist, mapping = aes(x = stat)) +\n  geom_histogram(binwidth = 0.01) +\n  labs(title = \"Null distribution\")\n```\n\n::: {.cell-output-display}\n![](u4-d12-hypothesis-testing_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=40%}\n:::\n:::\n\n\n---\n\n\n## Calculating the p-value, visually\n\n.question[\nWhat is the p-value, i.e. in what % of the simulations was the simulated sample proportion at least as extreme as the observed sample proportion?\n]\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u4-d12-hypothesis-testing_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=50%}\n:::\n:::\n\n---\n\n## Calculating the p-value, directly\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nnull_dist %>%\n  filter(stat <= (3/62)) %>%\n  summarise(p_value = n()/nrow(null_dist))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  p_value\n    <dbl>\n1    0.12\n```\n:::\n:::\n\n\n---\n\n\n## Significance level\n\nWe often use 5% as the cutoff for whether the p-value is low enough that the data are unlikely to have come from the null model. This cutoff value is called the **significance level**, $\\alpha$.\n\n- If p-value < $\\alpha$, reject $H_0$ in favor of $H_A$: The data provide convincing evidence for the alternative hypothesis.\n\n- If p-value > $\\alpha$, fail to reject $H_0$ in favor of $H_A$: The data do not provide convincing evidence for the alternative hypothesis.\n\n\n---\n\n## Conclusion\n\n.question[\nWhat is the conclusion of the hypothesis test?\n]\n\n--\n\nSince the p-value is greater than the significance level, we fail to reject the null hypothesis. \nThese data do not provide convincing evidence that this consultant incurs a lower complication rate than 10% (overall US complication rate).\n\n---\n\n\n## Let's get real\n\n- 100 simulations is not sufficient\n\n- We usually simulate around 15,000 times to get an accurate distribution, but we'll do 1,000 here for efficiency.\n\n\n---\n\n## Run the test\n\n.small[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nnull_dist <- organ_donor %>%\n  specify(response = outcome, success = \"complication\") %>%\n  hypothesize(null = \"point\", p = c(\"complication\" = 0.10, \"no complication\" = 0.90)) %>% \n  generate(reps = 1000, type = \"simulate\") %>% \n  calculate(stat = \"prop\")\n```\n:::\n]\n\n---\n\n\n## Visualize and calculate\n\n.small[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = null_dist, mapping = aes(x = stat)) +\n  geom_histogram(binwidth = 0.01) +\n  geom_vline(xintercept = 3/62, color = \"red\")\n```\n\n::: {.cell-output-display}\n![](u4-d12-hypothesis-testing_files/figure-html/unnamed-chunk-14-1.png){fig-align='center' width=30%}\n:::\n\n```{.r .cell-code}\nnull_dist %>%\n  filter(stat <= 3/62) %>%\n  summarise(p_value = n()/nrow(null_dist))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  p_value\n    <dbl>\n1   0.124\n```\n:::\n:::\n\n]\n\n\n---\n\nclass: middle\n\n# One vs. two sided hypothesis tests\n\n---\n\n\n## Types of alternative hypotheses\n\n- One sided (one tailed) alternatives: The parameter is hypothesized to be less than or greater than the null value, < or >\n\n--\n\n- Two sided (two tailed) alternatives: The parameter is hypothesized to be not equal to the null value, $\\ne$\n    - Calculated as two times the tail area beyond the observed sample statistic\n    - More objective, and hence more widely preferred\n    \n--\n\n.question[\nAverage systolic blood pressure of people with \nStage 1 Hypertension is 150 mm Hg. \nSuppose we want to use a hypothesis test to evaluate whether a new blood pressure medication has <b>an effect</b> on the average blood pressure of heart patients. What are the hypotheses?\n]\n\n\n---\n\nclass: middle\n\n# Testing for independence\n\n---\n\n\n## Is yawning contagious?\n\n.question[\nDo you think yawning is contagious?\n]\n\n.pull-left[\n![](img/yawn1.png)\n]\n.pull-right[\n![](img/yawn2.png)\n]\n\n\n---\n\n## Is yawning contagious?\n\nAn experiment conducted by the MythBusters tested if a person can be subconsciously influenced into yawning if another person near them yawns.\n\nhttps://www.discovery.com/tv-shows/mythbusters/videos/is-yawning-contagious-2\n\n---\n\n\n## Study description\n\nIn this study 50 people were randomly assigned to two groups: 34 to a group where a person near them yawned (treatment) and 16 to a control group where they didn't see someone yawn (control).\n\nThe data are in the **openintro** package: `yawn`\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nyawn %>%\n  count(group, result)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 3\n  group result       n\n  <fct> <fct>    <int>\n1 ctrl  not yawn    12\n2 ctrl  yawn         4\n3 trmt  not yawn    24\n4 trmt  yawn        10\n```\n:::\n:::\n\n---\n\n## Proportion of yawners\n\n.small[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nyawn %>%\n  count(group, result) %>%\n  group_by(group) %>%\n  mutate(p_hat = n / sum(n))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 4\n# Groups:   group [2]\n  group result       n p_hat\n  <fct> <fct>    <int> <dbl>\n1 ctrl  not yawn    12 0.75 \n2 ctrl  yawn         4 0.25 \n3 trmt  not yawn    24 0.706\n4 trmt  yawn        10 0.294\n```\n:::\n:::\n]\n\n- Proportion of yawners in the treatment group: $\\frac{10}{34} = 0.2941$\n- Proportion of yawners in the control group: $\\frac{4}{16} = 0.25$\n- Difference: $0.2941 - 0.25 = 0.0441$\n- Our results match the ones calculated on the MythBusters episode.\n\n---\n\n\n## Independence?\n\n.question[\nBased on the proportions we calculated, do you think yawning is really contagious, i.e. are seeing someone yawn and yawning dependent?\n]\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 4 × 4\n# Groups:   group [2]\n  group result       n p_hat\n  <fct> <fct>    <int> <dbl>\n1 ctrl  not yawn    12 0.75 \n2 ctrl  yawn         4 0.25 \n3 trmt  not yawn    24 0.706\n4 trmt  yawn        10 0.294\n```\n:::\n:::\n\n---\n\n## Dependence, or another possible explanation?\n\n- The observed differences might suggest that yawning is contagious, i.e. seeing someone yawn and yawning are dependent.\n\n- But the differences are small enough that we might wonder if they might simple be **due to chance**.\n\n- Perhaps if we were to repeat the experiment, we would see slightly different results.\n\n- So we will do just that - well, somewhat - and see what happens.\n\n- Instead of actually conducting the experiment many times, we will **simulate** our results.\n\n---\n\n\n## Two competing claims\n\n- \"There is nothing going on.\" \nYawning and seeing someone yawn are **independent**, yawning is not contagious, observed difference in proportions is simply due to chance. $\\rightarrow$ Null hypothesis\n\n- \"There is something going on.\"\nYawning and seeing someone yawn are **dependent**, yawning is contagious, observed difference in proportions is not due to chance. $\\rightarrow$ Alternative hypothesis\n\n\n---\n\n## Simulation setup\n\n1. A regular deck of cards is comprised of 52 cards: 4 aces, 4 of numbers 2-10, 4 jacks, 4 queens, and 4 kings.\n\n2. Take out two aces from the deck of cards and set them aside.\n\n3. The remaining 50 playing cards to represent each participant in the study:\n    - 14 face cards (including the 2 aces) represent the people who yawn.\n    - 36 non-face cards represent the people who don't yawn.\n\n---\n\n\n## Running the simulation\n\n1. Shuffle the 50 cards at least 7 times<sup>1</sup> to ensure that the cards counted out are from a random process.\n\n2. Count out the top 16 cards and set them aside. These cards represent the people in the control group.\n\n3. Out of the remaining 34 cards (treatment group) count the \\red{number of face cards} (the number of people who yawned in the treatment group).\n\n4. Calculate the difference in proportions of yawners (treatment - control), and plot it \non the board.\n\n5. Mark the difference you find on the dot plot on the board.\n\n.footnote[\n[1] http://www.dartmouth.edu/~chance/course/topics/winning_number.html\n]\n\n\n---\n\n## Simulation by hand\n\n.question[\nDo the simulation results suggest that yawning is contagious, i.e. does seeing someone yawn and yawning appear to be dependent?\n]\n\n![yawn-sim-results](img/yawn-sim-results.png)\n\n---\n\n\n## Simulation by computation\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nnull_dist <- yawn %>%\n  specify(response = result, explanatory = group, \n          success = \"yawn\") %>%\n  hypothesize(null = \"independence\") %>%\n  generate(100, type = \"permute\") %>%\n  calculate(stat = \"diff in props\", \n            order = c(\"trmt\", \"ctrl\"))\n```\n:::\n\n---\n\n## Simulation by computation - 1\n\n.small[\n- Start with the data frame\n- **Specify the variables**\n    - **Since the response variable is categorical, specify the level which should be considered as \"success\"**\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nyawn %>%\n{{  specify(response = result, explanatory = group, \n          success = \"yawn\") }}\n```\n:::\n]\n\n---\n\n\n## Simulation by computation - 2\n\n.small[\n- Start with the data frame\n- Specify the variables\n    - Since the response variable is categorical, specify the level which should be considered as \"success\"\n- **State the null hypothesis (yawning and whether or not you see someone yawn are independent)**\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nyawn %>%\n  specify(response = result, explanatory = group, \n          success = \"yawn\") %>%\n{{ hypothesize(null = \"independence\") }}\n```\n:::\n\n]\n\n\n---\n\n## Simulation by computation - 3\n\n.small[\n- Start with the data frame\n- Specify the variables\n    - Since the response variable is categorical, specify the level which should be considered as \"success\"\n- State the null hypothesis (yawning and whether or not you see someone yawn are independent)\n- **Generate simulated differences via permutation**\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nyawn %>%\n  specify(response = result, explanatory = group, \n          success = \"yawn\") %>%\n  hypothesize(null = \"independence\") %>%\n{{ generate(100, type = \"permute\") }}\n```\n:::\n]\n\n---\n\n\n## Simulation by computation - 4\n\n.small[\n- Start with the data frame\n- Specify the variables\n    - Since the response variable is categorical, specify the level which should be considered as \"success\"\n- State the null hypothesis (yawning and whether or not you see someone yawn are independent)\n- Generate simulated differences via permutation\n- **Calculate the sample statistic of interest (difference in propotions)**\n    - **Since the explanatory variable is categorical, specify the order in which the subtraction should occur for the calculation of the sample statistic, $(\\hat{p}_{treatment} - \\hat{p}_{control})$.**\n    \n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nyawn %>%\n  specify(response = result, explanatory = group, \n          success = \"yawn\") %>%\n  hypothesize(null = \"independence\") %>%\n  generate(100, type = \"permute\") %>%\n{{ calculate(stat = \"diff in props\", \n           order = c(\"trmt\", \"ctrl\")) }}\n```\n:::\n\n]\n\n\n---\n\n## Simulation by computation - 0\n\n.small[\n- **Save the result**\n- Start with the data frame\n- Specify the variables\n    - Since the response variable is categorical, specify the level which should be considered as \"success\"\n- State the null hypothesis (yawning and whether or not you see someone yawn are independent)\n- Generate simulated differences via permutation\n- Calculate the sample statistic of interest (difference in propotions)\n    - Since the explanatory variable is categorical, specify the order in which the subtraction should occur for the calculation of the sample statistic, $(\\hat{p}_{treatment} - \\hat{p}_{control})$.\n    \n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\n{{null_dist <- yawn %>% }}\n  specify(response = outcome, explanatory = group, \n          success = \"yawn\") %>%\n  hypothesize(null = \"independence\") %>%\n  generate(100, type = \"permute\") %>%\n  calculate(stat = \"diff in props\", \n            order = c(\"treatment\", \"control\"))\n```\n:::\n]\n\n---\n\n\n## Visualizing the null distribution\n\n.question[\nWhat would you expect the center of the null distribution to be?\n]\n\n--\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(data = null_dist, mapping = aes(x = stat)) +\n  geom_histogram(binwidth = 0.05) +\n  labs(title = \"Null distribution\")\n```\n\n::: {.cell-output-display}\n![](u4-d12-hypothesis-testing_files/figure-html/unnamed-chunk-24-1.png){fig-align='center' width=70%}\n:::\n:::\n\n---\n\n## Calculating the p-value, visually\n\n.question[\nWhat is the p-value, i.e. in what % of the \nsimulations was the simulated difference in sample proportion at least as extreme \nas the observed difference in sample proportions?\n]\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u4-d12-hypothesis-testing_files/figure-html/unnamed-chunk-25-1.png){fig-align='center' width=80%}\n:::\n:::\n\n---\n\n\n## Calculating the p-value, directly\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nnull_dist %>%\n  filter(stat >= 0.0441) %>%\n  summarise(p_value = n()/nrow(null_dist))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 1 × 1\n  p_value\n    <dbl>\n1    0.53\n```\n:::\n:::\n\n---\n\n## Conclusion\n\n.question[\nWhat is the conclusion of the hypothesis test?\n]\n\n<br>\n\n--\n\n.question[\nDo you \"buy\" this conclusion?\n]\n",
    "supporting": [
      "u4-d12-hypothesis-testing_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/font-awesome/css/all.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/font-awesome/css/v4-shims.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/panelset/panelset.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/panelset/panelset.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}