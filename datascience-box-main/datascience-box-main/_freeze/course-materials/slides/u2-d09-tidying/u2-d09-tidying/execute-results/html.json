{
  "hash": "da118f2d4650727f14be5efdc4ee0d1e",
  "result": {
    "markdown": "---\ntitle: \"Tidying data\"\nsubtitle: \"<br><br> Data Science in a Box\"\nauthor: \"[datasciencebox.org](https://datasciencebox.org/)\"\noutput:\n  xaringan::moon_reader:\n    css: [\"../xaringan-themer.css\", \"../slides.css\"]\n    lib_dir: libs\n    nature:\n      ratio: \"16:9\"\n      highlightLines: true\n      highlightStyle: solarized-light\n      countIncrementalSlides: false\n---\n\n\n\n\nlayout: true\n  \n<div class=\"my-footer\">\n<span>\n<a href=\"https://datasciencebox.org\" target=\"_blank\">datasciencebox.org</a>\n</span>\n</div> \n\n---\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\nclass: middle\n\n# .hand[We...]\n\n.huge[.green[have]] .hand[data organised in an unideal way for our analysis]\n\n.huge[.pink[want]] .hand[to reorganise the data to carry on with our analysis]\n\n\n---\n\n## Data: Sales\n\n\n\n\n<br>\n\n.pull-left[\n### .green[We have...]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 4\n  customer_id item_1 item_2       item_3\n        <dbl> <chr>  <chr>        <chr> \n1           1 bread  milk         banana\n2           2 milk   toilet paper <NA>  \n```\n:::\n:::\n]\n\n--\n.pull-right[\n### .pink[We want...]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  customer_id item_no item        \n        <dbl> <chr>   <chr>       \n1           1 item_1  bread       \n2           1 item_2  milk        \n3           1 item_3  banana      \n4           2 item_1  milk        \n5           2 item_2  toilet paper\n6           2 item_3  <NA>        \n```\n:::\n:::\n]\n\n---\n\n\n## A grammar of data tidying\n\n.pull-left[\n\n::: {.cell layout-align=\"center\" caption='tidyr is part of the tidyverse'}\n::: {.cell-output-display}\n![](img/tidyr-part-of-tidyverse.png){fig-align='center' width=60%}\n:::\n:::\n\n]\n.pull-right[\nThe goal of tidyr is to help you tidy your data via\n\n- pivoting for going between wide and long data\n- splitting and combining character columns\n- nesting and unnesting columns\n- clarifying how `NA`s should be treated\n]\n\n\n---\n\nclass: middle\n\n# Pivoting data\n\n---\n\n\n## Not this...\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](img/pivot.gif){fig-align='center' width=70%}\n:::\n:::\n\n---\n\n## but this!\n\n.center[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](img/tidyr-longer-wider.gif){fig-align='center' width=45% style=\"background-color: #FDF6E3\"}\n:::\n:::\n]\n\n---\n\n\n## Wider vs. longer\n\n.pull-left[\n### .green[wider]\nmore columns\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 4\n  customer_id item_1 item_2       item_3\n        <dbl> <chr>  <chr>        <chr> \n1           1 bread  milk         banana\n2           2 milk   toilet paper <NA>  \n```\n:::\n:::\n\n]\n\n--\n.pull-right[\n### .pink[longer]\nmore rows\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  customer_id item_no item        \n        <dbl> <chr>   <chr>       \n1           1 item_1  bread       \n2           1 item_2  milk        \n3           1 item_3  banana      \n4           2 item_1  milk        \n5           2 item_2  toilet paper\n6           2 item_3  <NA>        \n```\n:::\n:::\n\n]\n\n\n---\n\n## `pivot_longer()`\n\n.pull-left[\n- `data` (as usual)\n]\n.pull-right[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npivot_longer(\n  data, #<<\n  cols, \n  names_to = \"name\", \n  values_to = \"value\"\n  )\n```\n:::\n]\n\n---\n\n\n## `pivot_longer()`\n\n.pull-left[\n- `data` (as usual)\n- `cols`: columns to pivot into longer format \n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npivot_longer(\n  data, \n  cols, #<<\n  names_to = \"name\", \n  values_to = \"value\"\n  )\n```\n:::\n\n]\n\n\n---\n\n## `pivot_longer()`\n\n.pull-left[\n- `data` (as usual)\n- `cols`: columns to pivot into longer format \n- `names_to`: name of the column where column names of pivoted variables go (character string)\n]\n.pull-right[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npivot_longer(\n  data, \n  cols, \n  names_to = \"name\", #<<\n  values_to = \"value\"\n  )\n```\n:::\n]\n\n---\n\n\n## `pivot_longer()`\n\n.pull-left[\n- `data` (as usual)\n- `cols`: columns to pivot into longer format \n- `names_to`: name of the column where column names of pivoted variables go (character string)\n- `values_to`: name of the column where data in pivoted variables go (character string)\n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npivot_longer(\n  data, \n  cols, \n  names_to = \"name\", \n  values_to = \"value\" #<<\n  )\n```\n:::\n\n]\n\n\n---\n\n## Customers $\\rightarrow$ purchases\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npurchases <- customers %>%\n  pivot_longer( #<<\n    cols = item_1:item_3,  # variables item_1 to item_3 #<<\n    names_to = \"item_no\",  # column names -> new column called item_no #<<\n    values_to = \"item\"     # values in columns -> new column called item #<<\n    ) #<<\n\npurchases\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 3\n  customer_id item_no item        \n        <dbl> <chr>   <chr>       \n1           1 item_1  bread       \n2           1 item_2  milk        \n3           1 item_3  banana      \n4           2 item_1  milk        \n5           2 item_2  toilet paper\n6           2 item_3  <NA>        \n```\n:::\n:::\n\n---\n\n\n## Why pivot?\n\nMost likely, because the next step of your analysis needs it\n\n--\n\n.pull-left[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprices\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5 × 2\n  item         price\n  <chr>        <dbl>\n1 avocado       0.5 \n2 banana        0.15\n3 bread         1   \n4 milk          0.8 \n5 toilet paper  3   \n```\n:::\n:::\n\n]\n.pull-right[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npurchases %>%\n  left_join(prices) #<<\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  customer_id item_no item         price\n        <dbl> <chr>   <chr>        <dbl>\n1           1 item_1  bread         1   \n2           1 item_2  milk          0.8 \n3           1 item_3  banana        0.15\n4           2 item_1  milk          0.8 \n5           2 item_2  toilet paper  3   \n6           2 item_3  <NA>         NA   \n```\n:::\n:::\n\n]\n\n\n---\n\n## Purchases $\\rightarrow$ customers\n\n.pull-left-narrow[\n- `data` (as usual)\n- `names_from`: which column in the long format contains the what should be column names in the wide format\n- `values_from`: which column in the long format contains the what should be values in the new columns in the wide format\n]\n.pull-right-wide[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npurchases %>%\n  pivot_wider( #<<\n    names_from = item_no, #<<\n    values_from = item #<<\n  ) #<<\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2 × 4\n  customer_id item_1 item_2       item_3\n        <dbl> <chr>  <chr>        <chr> \n1           1 bread  milk         banana\n2           2 milk   toilet paper <NA>  \n```\n:::\n:::\n]\n\n---\n\n\nclass: middle\n\n# Case study: Approval rating of Donald Trump\n\n\n---\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](img/trump-approval.png){fig-align='center' width=70%}\n:::\n:::\n\n.footnote[\nSource: [FiveThirtyEight](https://projects.fivethirtyeight.com/trump-approval-ratings/adults/)\n]\n\n---\n\n\n## Data\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntrump\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 2,702 × 4\n   subgroup date       approval disapproval\n   <chr>    <date>        <dbl>       <dbl>\n 1 Voters   2020-10-04     44.7        52.2\n 2 Adults   2020-10-04     43.2        52.6\n 3 Adults   2020-10-03     43.2        52.6\n 4 Voters   2020-10-03     45.0        51.7\n 5 Adults   2020-10-02     43.3        52.4\n 6 Voters   2020-10-02     44.5        52.1\n 7 Voters   2020-10-01     44.1        52.8\n 8 Adults   2020-10-01     42.7        53.3\n 9 Adults   2020-09-30     42.2        53.7\n10 Voters   2020-09-30     44.2        52.7\n# … with 2,692 more rows\n```\n:::\n:::\n\n---\n\n## Goal\n\n.pull-left-wide[\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d09-tidying_files/figure-html/unnamed-chunk-20-1.png){fig-align='center' width=100%}\n:::\n:::\n]\n--\n.pull-right-narrow[\n**Aesthetic mappings:**  \n✅  x = `date`  \n❌      y = `rating_value`  \n❌      color = `rating_type`\n\n**Facet:**  \n✅  `subgroup` (Adults and Voters)\n]\n\n---\n\n\n## Pivot\n\n\n::: {.cell layout-align=\"center\" output.lines='11'}\n\n```{.r .cell-code}\ntrump_longer <- trump %>%\n  pivot_longer(\n    cols = c(approval, disapproval),\n    names_to = \"rating_type\",\n    values_to = \"rating_value\"\n  )\n\ntrump_longer\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 5,404 × 4\n   subgroup date       rating_type rating_value\n   <chr>    <date>     <chr>              <dbl>\n 1 Voters   2020-10-04 approval            44.7\n 2 Voters   2020-10-04 disapproval         52.2\n 3 Adults   2020-10-04 approval            43.2\n 4 Adults   2020-10-04 disapproval         52.6\n 5 Adults   2020-10-03 approval            43.2\n 6 Adults   2020-10-03 disapproval         52.6\n 7 Voters   2020-10-03 approval            45.0\n 8 Voters   2020-10-03 disapproval         51.7\n...\n```\n:::\n:::\n\n---\n\n## Plot\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(trump_longer, \n       aes(x = date, y = rating_value, color = rating_type, group = rating_type)) +\n  geom_line() +\n  facet_wrap(~ subgroup)\n```\n\n::: {.cell-output-display}\n![](u2-d09-tidying_files/figure-html/unnamed-chunk-22-1.png){fig-align='center' width=60%}\n:::\n:::\n\n---\n\n\n.panelset[\n\n.panel[.panel-name[Code]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(trump_longer, \n       aes(x = date, y = rating_value, \n           color = rating_type, group = rating_type)) +\n  geom_line() +\n  facet_wrap(~ subgroup) +\n  scale_color_manual(values = c(\"darkgreen\", \"orange\")) + #<<\n  labs( #<<\n    x = \"Date\", y = \"Rating\", #<<\n    color = NULL, #<<\n    title = \"How (un)popular is Donald Trump?\", #<<\n    subtitle = \"Estimates based on polls of all adults and polls of likely/registered voters\", #<<\n    caption = \"Source: FiveThirtyEight modeling estimates\" #<<\n  ) #<<\n```\n:::\n\n]\n\n.panel[.panel-name[Plot]\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d09-tidying_files/figure-html/unnamed-chunk-23-1.png){fig-align='center' width=75%}\n:::\n:::\n\n]\n\n]\n\n\n---\n\n.panelset[\n\n.panel[.panel-name[Code]\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(trump_longer, \n       aes(x = date, y = rating_value, \n           color = rating_type, group = rating_type)) +\n  geom_line() +\n  facet_wrap(~ subgroup) +\n  scale_color_manual(values = c(\"darkgreen\", \"orange\")) + \n  labs( \n    x = \"Date\", y = \"Rating\", \n    color = NULL, \n    title = \"How (un)popular is Donald Trump?\", \n    subtitle = \"Estimates based on polls of all adults and polls of likely/registered voters\", \n    caption = \"Source: FiveThirtyEight modeling estimates\" \n  ) + \n  theme_minimal() + #<<\n  theme(legend.position = \"bottom\") #<<\n```\n:::\n]\n\n.panel[.panel-name[Plot]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d09-tidying_files/figure-html/unnamed-chunk-24-1.png){fig-align='center' width=75%}\n:::\n:::\n]\n\n]\n",
    "supporting": [
      "u2-d09-tidying_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/font-awesome/css/all.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/font-awesome/css/v4-shims.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/panelset/panelset.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/panelset/panelset.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}