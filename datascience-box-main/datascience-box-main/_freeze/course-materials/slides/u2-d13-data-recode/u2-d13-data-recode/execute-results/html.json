{
  "hash": "9462646a75af0deaf8b8e8de281267f7",
  "result": {
    "markdown": "---\ntitle: \"Recoding data\"\nsubtitle: \"<br><br> Data Science in a Box\"\nauthor: \"[datasciencebox.org](https://datasciencebox.org/)\"\noutput:\n  xaringan::moon_reader:\n    css: [\"../xaringan-themer.css\", \"../slides.css\"]\n    lib_dir: libs\n    nature:\n      ratio: \"16:9\"\n      highlightLines: true\n      highlightStyle: solarized-light\n      countIncrementalSlides: false\n---\n\n\n\n\nlayout: true\n  \n<div class=\"my-footer\">\n<span>\n<a href=\"https://datasciencebox.org\" target=\"_blank\">datasciencebox.org</a>\n</span>\n</div> \n\n---\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\nclass: middle\n\n# Case study: Religion and income\n\n\n---\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](img/relig-income.png){fig-align='center' width=75%}\n:::\n:::\n\n.footnote[\nSource: [pewforum.org/religious-landscape-study/income-distribution](https://www.pewforum.org/religious-landscape-study/income-distribution/), Retrieved 14 April, 2020\n]\n\n---\n\n\n## Read data \n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(readxl)\nrel_inc <- read_excel(\"data/relig-income.xlsx\")\n```\n:::\n\n\n.small[\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 × 6\n  `Religious tradition`         `Less than $30…` `$30,000-$49,9…`\n  <chr>                                    <dbl>            <dbl>\n1 Buddhist                                  0.36             0.18\n2 Catholic                                  0.36             0.19\n3 Evangelical Protestant                    0.35             0.22\n4 Hindu                                     0.17             0.13\n5 Historically Black Protestant             0.53             0.22\n6 Jehovah's Witness                         0.48             0.25\n# … with 6 more rows, and 3 more variables:\n#   `$50,000-$99,999` <dbl>, `$100,000 or more` <dbl>,\n#   `Sample Size` <dbl>\n```\n:::\n:::\n\n]\n\n\n---\n\n## Rename columns\n\n.midi[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrel_inc %>%\n  rename( \n    religion = `Religious tradition`, \n    n = `Sample Size` \n  ) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 12 × 6\n  religion     `Less than $30…` `$30,000-$49,9…` `$50,000-$99,9…`\n  <chr>                   <dbl>            <dbl>            <dbl>\n1 Buddhist                 0.36             0.18             0.32\n2 Catholic                 0.36             0.19             0.26\n3 Evangelical…             0.35             0.22             0.28\n4 Hindu                    0.17             0.13             0.34\n5 Historicall…             0.53             0.22             0.17\n6 Jehovah's W…             0.48             0.25             0.22\n# … with 6 more rows, and 2 more variables:\n#   `$100,000 or more` <dbl>, n <dbl>\n```\n:::\n:::\n]\n\n---\n\n\n.question[\nIf we want a new variable called `income` with levels such as \"Less than $30,000\", \"$30,000-$49,999\", ... etc. which function should we use?\n]\n\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 48 × 4\n   religion                   n income            proportion\n   <chr>                  <dbl> <chr>                  <dbl>\n 1 Buddhist                 233 Less than $30,000       0.36\n 2 Buddhist                 233 $30,000-$49,999         0.18\n 3 Buddhist                 233 $50,000-$99,999         0.32\n 4 Buddhist                 233 $100,000 or more        0.13\n 5 Catholic                6137 Less than $30,000       0.36\n 6 Catholic                6137 $30,000-$49,999         0.19\n 7 Catholic                6137 $50,000-$99,999         0.26\n 8 Catholic                6137 $100,000 or more        0.19\n 9 Evangelical Protestant  7462 Less than $30,000       0.35\n10 Evangelical Protestant  7462 $30,000-$49,999         0.22\n11 Evangelical Protestant  7462 $50,000-$99,999         0.28\n12 Evangelical Protestant  7462 $100,000 or more        0.14\n13 Hindu                    172 Less than $30,000       0.17\n14 Hindu                    172 $30,000-$49,999         0.13\n15 Hindu                    172 $50,000-$99,999         0.34\n# … with 33 more rows\n```\n:::\n:::\n\n---\n\n## Pivot longer\n\n.midi[\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrel_inc %>%\n  rename(\n    religion = `Religious tradition`,\n    n = `Sample Size`\n  ) %>%\n  pivot_longer( \n    cols = -c(religion, n),   # all but religion and n \n    names_to = \"income\",  \n    values_to = \"proportion\" \n  ) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 48 × 4\n  religion     n income            proportion\n  <chr>    <dbl> <chr>                  <dbl>\n1 Buddhist   233 Less than $30,000       0.36\n2 Buddhist   233 $30,000-$49,999         0.18\n3 Buddhist   233 $50,000-$99,999         0.32\n4 Buddhist   233 $100,000 or more        0.13\n5 Catholic  6137 Less than $30,000       0.36\n6 Catholic  6137 $30,000-$49,999         0.19\n# … with 42 more rows\n```\n:::\n:::\n]\n\n---\n\n\n## Calculate frequencies\n\n.midi[\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrel_inc %>%\n  rename(\n    religion = `Religious tradition`,\n    n = `Sample Size`\n  ) %>%\n  pivot_longer(\n    cols = -c(religion, n), \n    names_to = \"income\", \n    values_to = \"proportion\"\n  ) %>%\n  mutate(frequency = round(proportion * n)) \n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 48 × 5\n  religion     n income            proportion frequency\n  <chr>    <dbl> <chr>                  <dbl>     <dbl>\n1 Buddhist   233 Less than $30,000       0.36        84\n2 Buddhist   233 $30,000-$49,999         0.18        42\n3 Buddhist   233 $50,000-$99,999         0.32        75\n4 Buddhist   233 $100,000 or more        0.13        30\n5 Catholic  6137 Less than $30,000       0.36      2209\n6 Catholic  6137 $30,000-$49,999         0.19      1166\n# … with 42 more rows\n```\n:::\n:::\n\n]\n\n\n---\n\n## Save data\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrel_inc_long <- rel_inc %>% \n  rename(\n    religion = `Religious tradition`,\n    n = `Sample Size`\n  ) %>%\n  pivot_longer(\n    cols = -c(religion, n), \n    names_to = \"income\", \n    values_to = \"proportion\"\n  ) %>%\n  mutate(frequency = round(proportion * n))\n```\n:::\n\n---\n\n\n## Barplot\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(rel_inc_long, aes(y = religion, x = frequency)) +\n  geom_col()\n```\n\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=65%}\n:::\n:::\n\n---\n\n## Recode religion\n\n.panelset[\n\n.panel[.panel-name[Recode]\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrel_inc_long <- rel_inc_long %>%\n  mutate(religion = case_when(\n    religion == \"Evangelical Protestant\"           ~ \"Ev. Protestant\",\n    religion == \"Historically Black Protestant\"    ~ \"Hist. Black Protestant\",\n    religion == 'Unaffiliated (religious \"nones\")' ~ \"Unaffiliated\",\n    TRUE                                           ~ religion\n  ))\n```\n:::\n]\n\n.panel[.panel-name[Plot]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=65%}\n:::\n:::\n]\n\n]\n\n---\n\n\n## Reverse religion order\n\n.panelset[\n\n.panel[.panel-name[Recode]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nrel_inc_long <- rel_inc_long %>%\n  mutate(religion = fct_rev(religion)) \n```\n:::\n\n]\n\n.panel[.panel-name[Plot]\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/unnamed-chunk-14-1.png){fig-align='center' width=65%}\n:::\n:::\n\n]\n\n]\n\n\n---\n\n## Add income\n\n.panelset[\n\n.panel[.panel-name[Plot]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/rel-income-1.png){fig-align='center' width=65%}\n:::\n:::\n]\n\n.panel[.panel-name[Code]\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) + \n  geom_col() \n```\n:::\n]\n\n]\n\n---\n\n\n## Fill bars\n\n.panelset[\n\n.panel[.panel-name[Plot]\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/rel-income-fill-1.png){fig-align='center' width=65%}\n:::\n:::\n\n]\n\n.panel[.panel-name[Code]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +\n  geom_col(position = \"fill\")\n```\n:::\n\n]\n\n]\n\n\n---\n\n## Change colors\n\n.panelset[\n\n.panel[.panel-name[Plot]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/rel-income-fill-viridis-1.png){fig-align='center' width=65%}\n:::\n:::\n]\n\n.panel[.panel-name[Code]\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +\n  geom_col(position = \"fill\") +\n  scale_fill_viridis_d()\n```\n:::\n]\n\n]\n\n---\n\n\n\n## Change theme\n\n.panelset[\n\n.panel[.panel-name[Plot]\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/rel-income-fill-viridis-minimal-1.png){fig-align='center' width=65%}\n:::\n:::\n\n]\n\n.panel[.panel-name[Code]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +\n  geom_col(position = \"fill\") +\n  scale_fill_viridis_d() +\n  theme_minimal() \n```\n:::\n\n]\n\n]\n\n\n---\n\n## Move legend to the bottom\n\n.panelset[\n\n.panel[.panel-name[Plot]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/bottom-legend-1.png){fig-align='center' width=65%}\n:::\n:::\n]\n\n.panel[.panel-name[Code]\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +\n  geom_col(position = \"fill\") +\n  scale_fill_viridis_d() +\n  theme_minimal() +\n  theme(legend.position = \"bottom\")\n```\n:::\n]\n\n]\n\n---\n\n\n## Legend adjustments\n\n.panelset[\n\n.panel[.panel-name[Plot]\n\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/unnamed-chunk-20-1.png){fig-align='center' width=65%}\n:::\n:::\n\n]\n\n.panel[.panel-name[Code]\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +\n  geom_col(position = \"fill\") +\n  scale_fill_viridis_d() +\n  theme_minimal() +\n  theme(legend.position = \"bottom\") +\n  guides(fill = guide_legend(nrow = 2, byrow = TRUE)) \n```\n:::\n\n]\n\n]\n\n\n---\n\n## Fix labels\n\n.panelset[\n\n.panel[.panel-name[Plot]\n::: {.cell layout-align=\"center\"}\n::: {.cell-output-display}\n![](u2-d13-data-recode_files/figure-html/unnamed-chunk-21-1.png){fig-align='center' width=65%}\n:::\n:::\n]\n\n.panel[.panel-name[Code]\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nggplot(rel_inc_long, aes(y = religion, x = frequency, fill = income)) +\n  geom_col(position = \"fill\") +\n  scale_fill_viridis_d() +\n  theme_minimal() +\n  theme(legend.position = \"bottom\") +\n  guides(fill = guide_legend(nrow = 2, byrow = TRUE)) +\n  labs(\n    x = \"Proportion\", y = \"\", \n    title = \"Income distribution by religious group\", \n    subtitle = \"Source: Pew Research Center, Religious Landscape Study\", \n    fill = \"Income\" \n    )\n```\n:::\n]\n\n]\n",
    "supporting": [
      "u2-d13-data-recode_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../../site_libs/font-awesome/css/all.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/font-awesome/css/v4-shims.css\" rel=\"stylesheet\" />\n<link href=\"../../../site_libs/panelset/panelset.css\" rel=\"stylesheet\" />\n<script src=\"../../../site_libs/panelset/panelset.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}